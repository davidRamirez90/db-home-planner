<section class="board" aria-label="Abfahrtstafel">
  <header class="board-header">
    <div class="board-title">
      <span class="board-icon" aria-hidden="true">ðŸš†</span>
      <span>{{ boardTitle() }}</span>
    </div>
    <div class="board-right">
      <div class="board-meta">
        <span class="board-label">STATUS</span>
        <span class="board-status" [attr.data-status]="requestStatus()">
          {{ displayStatus() }}
        </span>
      </div>
      <div class="board-clock">
        @if (showSegmentDisplay) {
          <span class="board-clock-segments" aria-hidden="true">
            @for (char of toChars(displayClock()); track $index; let i = $index) {
              <app-segment-display [value]="char" [delayMs]="i * 20" />
            }
          </span>
          <span class="sr-only">AKTUELLE UHRZEIT {{ displayClock() }}</span>
        } @else {
          <span class="board-clock-text">{{ displayClock() }}</span>
        }
      </div>
    </div>
  </header>

  @if (errorMessage()) {
    <p class="board-error">{{ displayErrorMessage() }}</p>
  }

  @if (!errorMessage() && requestStatus() === 'success' && boardRows().length === 0) {
    <p class="board-empty">NOCH KEINE VERFOLGTEN ROUTEN. FÃœGE EINE IN DER ADMIN-KONFIGURATION HINZU.</p>
  }

  <div class="board-grid" role="table" aria-label="AbfahrtsÃ¼bersicht">
    <div class="board-row board-row--header" role="row">
      <span class="board-cell board-cell--line" role="columnheader">LINIE</span>
      <span class="board-cell" role="columnheader">STATION</span>
      <span class="board-cell" role="columnheader">ZEIT</span>
      <span class="board-cell board-cell--rest" role="columnheader">REST</span>
      <span class="board-cell" role="columnheader">STATUS</span>
      <span class="board-cell board-cell--action" role="columnheader">AKTION</span>
    </div>

    @for (row of boardRows(); track $index) {
      <div class="board-row" role="row">
        <span class="board-cell board-cell--line" role="cell">
          <span class="board-line">
            <span class="board-line-badge" aria-hidden="true">{{ row.lineBadge }}</span>
            @if (showSegmentDisplay) {
              <span class="board-text board-text--segments" aria-hidden="true">
                @for (char of toChars(row.line); track $index; let i = $index) {
                  <app-segment-display [value]="char" [delayMs]="i * 35" />
                }
              </span>
              <span class="sr-only">{{ row.line }}</span>
            } @else {
              <span class="board-text">{{ row.line }}</span>
            }
          </span>
        </span>
        <span class="board-cell" role="cell">
          @if (showSegmentDisplay) {
            <span class="board-text board-text--segments" aria-hidden="true">
              @for (char of toChars(row.station); track $index; let i = $index) {
                <app-segment-display [value]="char" [delayMs]="i * 35" />
              }
            </span>
            <span class="sr-only">{{ row.station }}</span>
          } @else {
            <span class="board-text">{{ row.station }}</span>
          }
        </span>
        <span class="board-cell" role="cell">
          @if (showSegmentDisplay) {
            <span class="board-text board-text--segments" aria-hidden="true">
              @for (char of toChars(row.departure); track $index; let i = $index) {
                <app-segment-display [value]="char" [delayMs]="i * 35" />
              }
            </span>
            <span class="sr-only">{{ row.departure }}</span>
          } @else {
            <span class="board-text">{{ row.departure }}</span>
          }
        </span>
        <span
          class="board-cell board-cell--rest"
          role="cell"
          [class.board-cell--urgent]="row.isUrgent"
        >
          @if (showSegmentDisplay && !row.isUrgent) {
            <span class="board-text board-text--segments" aria-hidden="true">
              @for (char of toChars(row.countdown); track $index; let i = $index) {
                <app-segment-display [value]="char" [delayMs]="i * 35" />
              }
            </span>
            <span class="sr-only">{{ row.countdown }}</span>
          } @else {
            <span class="board-text">{{ row.countdown }}</span>
          }
        </span>
        <span class="board-cell" role="cell">
          @if (showSegmentDisplay) {
            <span class="board-text board-text--segments" aria-hidden="true">
              @for (char of toChars(row.status); track $index; let i = $index) {
                <app-segment-display [value]="char" [delayMs]="i * 35" />
              }
            </span>
            <span class="sr-only">{{ row.status }}</span>
          } @else {
            <span class="board-text">{{ row.status }}</span>
          }
        </span>
        <span
          class="board-cell board-cell--action"
          role="cell"
          [attr.aria-label]="row.actionDetail || row.actionLabel"
        >
          <span class="board-action">
            @if (row.actionIcon) {
              <span class="board-action-icon" aria-hidden="true">{{ row.actionIcon }}</span>
            }
            <span class="board-action-label">
              @if (showSegmentDisplay) {
                <span class="board-text board-text--segments" aria-hidden="true">
                  @for (char of toChars(row.actionLabel); track $index; let i = $index) {
                    <app-segment-display [value]="char" [delayMs]="i * 35" />
                  }
                </span>
                <span class="sr-only">{{ row.actionLabel }}</span>
              } @else {
                <span class="board-text">{{ row.actionLabel }}</span>
              }
            </span>
          </span>
        </span>
      </div>
    }
  </div>
</section>
